(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["severalFeeConfig"],{"07e8":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cube-page",class:e.type},[a("header",{staticClass:"header"},[a("h1",[e._v(e._s(e.title))]),a("i",{directives:[{name:"show",rawName:"v-show",value:e.isBack,expression:"isBack"}],staticClass:"cubeic-back",on:{click:e.back}}),a("div",{staticClass:"header-edit"},[e._t("edit")],2)]),a("div",{class:{wrapper:!0,isWhite:"white"===e.type}},[a("main",{staticClass:"content"},[e._t("content",[e._v(e._s(e.content))])],2)])])},r=[],i=a("d225"),l=a("b0b4"),s=a("308d"),o=a("6bb5"),c=a("4e2b"),u=a("9ab4"),p=a("60a3"),d=function(e){function t(){return Object(i["a"])(this,t),Object(s["a"])(this,Object(o["a"])(t).apply(this,arguments))}return Object(c["a"])(t,e),Object(l["a"])(t,[{key:"back",value:function(){this.$router.go(-1)}},{key:"created",value:function(){console.log("创建page ===")}}]),t}(p["c"]);Object(u["a"])([Object(p["b"])()],d.prototype,"msg",void 0),Object(u["a"])([Object(p["b"])({default:"",required:!0})],d.prototype,"title",void 0),Object(u["a"])([Object(p["b"])({default:""})],d.prototype,"type",void 0),Object(u["a"])([Object(p["b"])({default:""})],d.prototype,"desc",void 0),Object(u["a"])([Object(p["b"])({default:""})],d.prototype,"content",void 0),Object(u["a"])([Object(p["b"])({default:!0})],d.prototype,"isBack",void 0),d=Object(u["a"])([Object(p["a"])({})],d);var f=d,v=f,g=(a("2de2"),a("2877")),b=Object(g["a"])(v,n,r,!1,null,"75d201ee",null);t["a"]=b.exports},"2de2":function(e,t,a){"use strict";var n=a("4867"),r=a.n(n);r.a},"35c0":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"fade"}},[e.visible?a("div",{staticClass:"edit-box"},[e._t("default")],2):e._e()])},r=[],i=a("d225"),l=a("b0b4"),s=a("308d"),o=a("6bb5"),c=a("4e2b"),u=a("9ab4"),p=a("60a3"),d=function(e){function t(){return Object(i["a"])(this,t),Object(s["a"])(this,Object(o["a"])(t).apply(this,arguments))}return Object(c["a"])(t,e),Object(l["a"])(t,[{key:"mounted",value:function(){}},{key:"hide",value:function(){this.$emit("update:visible",!1)}}]),t}(p["c"]);Object(u["a"])([Object(p["b"])({default:!1})],d.prototype,"visible",void 0),d=Object(u["a"])([Object(p["a"])({components:{}})],d);var f=d,v=f,g=(a("fa15"),a("2877")),b=Object(g["a"])(v,n,r,!1,null,"d5ca93a2",null);t["a"]=b.exports},4867:function(e,t,a){},"51f3":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"right-box"},e._l(e.list,function(t,n){return a("div",{key:n,staticClass:"box",on:{click:function(a){return e.boxClick(t.action)}}},[t.icon?a("i",{class:["iconfont",t.icon]}):a("span",[e._v(e._s(t.text))])])}),0)},r=[],i=a("d225"),l=a("b0b4"),s=a("308d"),o=a("6bb5"),c=a("4e2b"),u=a("9ab4"),p=a("60a3"),d=function(e){function t(){return Object(i["a"])(this,t),Object(s["a"])(this,Object(o["a"])(t).apply(this,arguments))}return Object(c["a"])(t,e),Object(l["a"])(t,[{key:"boxClick",value:function(e){this.$emit("click",e)}}]),t}(p["c"]);Object(u["a"])([Object(p["b"])()],d.prototype,"list",void 0),d=Object(u["a"])([p["a"]],d);var f=d,v=f,g=(a("b493"),a("2877")),b=Object(g["a"])(v,n,r,!1,null,"1bd23a4e",null);t["a"]=b.exports},a387:function(e,t,a){},b3b4:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("page",{attrs:{title:e.pageTitle}},[a("div",{staticClass:"edit",attrs:{slot:"edit"},slot:"edit"}),a("div",{staticClass:"content",attrs:{slot:"content"},slot:"content"},[a("div",{staticClass:"shop-admin-box"},[a("cube-form",{ref:"editForm",attrs:{model:e.model,"immediate-validate":!1,options:e.options},on:{validate:e.validateHandler,submit:e.submitHandler,reset:e.resetHandler}},[a("cube-form-group",{attrs:{legend:"按份规则"}},[e._v("\n          "+e._s(e.rewardConfig)+"\n          "),e._l(e.fields,function(e,t){return a("cube-form-item",{key:t,attrs:{field:e}})}),"surcharge"===e.model.drawmode?a("div",{staticClass:"surcharge"},[e._l(e.surchargeConfig,function(t,n){return a("div",{key:n,staticClass:"ladder-box"},[a("span",[a("cube-input",{model:{value:t.label,callback:function(a){e.$set(t,"label",a)},expression:"lItem.label"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("名称")])])],1),a("div",[a("div",[e._v("触发方式")]),a("cube-radio-group",{attrs:{horizontal:!0,options:e.options2,position:"right","hollow-style":!0},model:{value:t.trigger,callback:function(a){e.$set(t,"trigger",a)},expression:"lItem.trigger"}})],1),"bycost"===t.trigger?a("div",[e._l(t.rule,function(t,r){return a("div",{key:r,staticStyle:{display:"flex"}},[a("span",[a("cube-input",{attrs:{min:0},model:{value:t.section[0],callback:function(a){e.$set(t.section,0,a)},expression:"ruleItem.section[0]"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("价格-大于等于")])])],1),a("span",[a("cube-input",{attrs:{min:0},model:{value:t.section[1],callback:function(a){e.$set(t.section,1,a)},expression:"ruleItem.section[1]"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("小于")])])],1),a("span",[a("cube-input",{attrs:{min:0},model:{value:t.fee,callback:function(a){e.$set(t,"fee",a)},expression:"ruleItem.fee"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("费用")])])],1),a("span",{on:{click:function(t){return e.deleteSection(n,r)}}},[e._v("删除")])])}),a("div",[a("cube-checkbox-group",{attrs:{options:e.sultoptions,horizontal:!0,"hollow-style":!0},model:{value:t.sultType,callback:function(a){e.$set(t,"sultType",a)},expression:"lItem.sultType"}})],1),a("cube-button",{on:{click:function(t){return e.addRule(n)}}},[e._v("新增规则")])],2):e._e(),a("span",{on:{click:function(t){return e.deleteConfig(n)}}},[e._v("删除")])])}),a("cube-button",{attrs:{inline:!0},on:{click:e.addSurcharge}},[e._v("新增附加费")])],2):e._e(),"delivery"===e.model.drawmode?a("div",{staticClass:"ladder"},[a("cube-radio-group",{attrs:{options:e.rewardOptions,horizontal:!0},model:{value:e.rewardConfig.type,callback:function(t){e.$set(e.rewardConfig,"type",t)},expression:"rewardConfig.type"}}),"fixed"===e.rewardConfig.type?a("div",[a("cube-input",{model:{value:e.rewardvalue.fixed.value,callback:function(t){e.$set(e.rewardvalue.fixed,"value",t)},expression:"rewardvalue.fixed.value"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("固定费用")])])],1):e._e(),"ladder"===e.rewardConfig.type?a("div",{staticClass:"ladder"},[e._l(e.rewardvalue.ladder,function(t,n){return a("div",{key:n,staticClass:"ladder-box"},[a("span",[a("cube-input",{attrs:{min:0},model:{value:t.section[0],callback:function(a){e.$set(t.section,0,a)},expression:"lItem.section[0]"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("价格-大于等于")])])],1),a("span",[a("cube-input",{attrs:{min:0},model:{value:t.section[1],callback:function(a){e.$set(t.section,1,a)},expression:"lItem.section[1]"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("小于")])])],1),a("span",[a("cube-input",{attrs:{min:0},model:{value:t.fee,callback:function(a){e.$set(t,"fee",a)},expression:"lItem.fee"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("抽成")])])],1),a("span",{on:{click:function(t){return e.deleteRewardLadder(n)}}},[e._v("删除")])])}),a("cube-button",{attrs:{inline:!0},on:{click:e.addRewardLadder}},[e._v("新增阶梯")])],2):e._e()],1):e._e(),"percentage"===e.model.drawmode?a("div",{staticClass:"ladder"},[a("cube-radio-group",{attrs:{options:e.percentageOptions,horizontal:!0},model:{value:e.percentageConfig.type,callback:function(t){e.$set(e.percentageConfig,"type",t)},expression:"percentageConfig.type"}}),"ladder"===e.percentageConfig.type?a("div",{staticClass:"ladder"},[e._l(e.percentageValue.ladder,function(t,n){return a("div",{key:e.index+n,staticClass:"ladder-box"},[a("div",[a("span",[a("cube-input",{attrs:{min:0},model:{value:t.section[0],callback:function(a){e.$set(t.section,0,a)},expression:"lItem.section[0]"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("价格-大于等于")])])],1),a("span",[a("cube-input",{attrs:{min:0},model:{value:t.section[1],callback:function(a){e.$set(t.section,1,a)},expression:"lItem.section[1]"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("小于")])])],1)]),a("div",[a("cube-radio-group",{attrs:{options:e.typeoptions,horizontal:!0},on:{input:function(a){return e.typeOptionsChange(n,t.type)}},model:{value:t.type,callback:function(a){e.$set(t,"type",a)},expression:"lItem.type"}}),"regular"==t.type?a("div",[a("cube-input",{attrs:{min:0},model:{value:t.fee,callback:function(a){e.$set(t,"fee",a)},expression:"lItem.fee"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("抽成")])])],1):e._e(),"bytype"==t.type?a("div",[a("cube-input",{attrs:{min:0},model:{value:t.typefee.delivery,callback:function(a){e.$set(t.typefee,"delivery",a)},expression:"lItem.typefee.delivery"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("外卖")])]),a("cube-input",{attrs:{min:0},model:{value:t.typefee.selflifting,callback:function(a){e.$set(t.typefee,"selflifting",a)},expression:"lItem.typefee.selflifting"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("自取")])])],1):e._e()],1),a("span",{on:{click:function(t){return e.deletePercentageLadder(e.index)}}},[e._v("删除")])])}),a("cube-button",{attrs:{inline:!0},on:{click:e.addPercentageLadder}},[e._v("新增阶梯")])],2):e._e(),"fixed"===e.percentageConfig.type?a("div",{staticClass:"ladder"},[a("cube-radio-group",{attrs:{options:e.typeoptions,horizontal:!0},on:{input:e.typeOptionsChange},model:{value:e.percentageValue.fixed.type,callback:function(t){e.$set(e.percentageValue.fixed,"type",t)},expression:"percentageValue.fixed.type"}}),"regular"==e.percentageValue.fixed.type?a("div",[a("cube-input",{attrs:{min:0},model:{value:e.percentageValue.fixed.value,callback:function(t){e.$set(e.percentageValue.fixed,"value",t)},expression:"percentageValue.fixed.value"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("抽成")])])],1):e._e(),"bytype"==e.percentageValue.fixed.type?a("div",[a("cube-input",{attrs:{min:0},model:{value:e.percentageValue.fixed.typeValue.delivery,callback:function(t){e.$set(e.percentageValue.fixed.typeValue,"delivery",t)},expression:"percentageValue.fixed.typeValue.delivery"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("外卖")])]),a("cube-input",{attrs:{min:0},model:{value:e.percentageValue.fixed.typeValue.selflifting,callback:function(t){e.$set(e.percentageValue.fixed.typeValue,"selflifting",t)},expression:"percentageValue.fixed.typeValue.selflifting"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("自取")])])],1):e._e()],1):e._e(),"percentage"===e.percentageConfig.type?a("div",{staticClass:"ladder"},[a("cube-radio-group",{attrs:{options:e.typeoptions,horizontal:!0},on:{input:e.typeOptionsChange},model:{value:e.percentageValue.percentage.type,callback:function(t){e.$set(e.percentageValue.percentage,"type",t)},expression:"percentageValue.percentage.type"}}),"regular"==e.percentageValue.percentage.type?a("div",[a("cube-input",{attrs:{min:0,max:100},model:{value:e.percentageValue.percentage.value,callback:function(t){e.$set(e.percentageValue.percentage,"value",t)},expression:"percentageValue.percentage.value"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("抽成")]),a("div",{attrs:{slot:"append"},slot:"append"},[e._v("%")])])],1):e._e(),"bytype"==e.percentageValue.percentage.type?a("div",[a("cube-input",{attrs:{min:0,max:100},model:{value:e.percentageValue.percentage.typeValue.delivery,callback:function(t){e.$set(e.percentageValue.percentage.typeValue,"delivery",t)},expression:"percentageValue.percentage.typeValue.delivery"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("外卖")]),a("div",{attrs:{slot:"append"},slot:"append"},[e._v("%")])]),a("cube-input",{attrs:{min:0,max:100},model:{value:e.percentageValue.percentage.typeValue.selflifting,callback:function(t){e.$set(e.percentageValue.percentage.typeValue,"selflifting",t)},expression:"percentageValue.percentage.typeValue.selflifting"}},[a("div",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("自取")]),a("div",{attrs:{slot:"append"},slot:"append"},[e._v("%")])])],1):e._e()],1):e._e()],1):e._e(),e._l(e.savefields,function(e,t){return a("cube-form-item",{key:t,attrs:{field:e}})})],2)],1)],1)])])},r=[],i=(a("c5f6"),a("d263"),a("d225")),l=a("b0b4"),s=a("308d"),o=a("6bb5"),c=a("4e2b"),u=a("9ab4"),p=a("60a3"),d=a("07e8"),f=a("51f3"),v=a("35c0"),g=a("c88e"),b=function(e){function t(){var e;return Object(i["a"])(this,t),e=Object(s["a"])(this,Object(o["a"])(t).apply(this,arguments)),e.showEditbox=!1,e.showAddNav=!1,e.pageTitle="按份规则",e.surchargeConfig=[],e.options2=[{label:"按费用",value:"bycost"}],e.sultoptions=[{label:"外卖",value:"delivery"},{label:"自提",value:"selflifting"}],e.rewardConfig={type:"fixed"},e.rewardOptions=[{label:"固定付费",value:"fixed"},{label:"阶梯付费",value:"ladder"}],e.rewardvalue={fixed:{value:0},ladder:[]},e.percentageConfig={type:"fixed"},e.percentageValue={ladder:[],fixed:{type:"",value:0,typeValue:{delivery:0,selflifting:0}},percentage:{type:"",value:0,typeValue:{delivery:0,selflifting:0}}},e.percentageOptions=[{label:"阶梯收费",value:"ladder"},{label:"固定收费",value:"fixed"},{label:"百分比",value:"percentage"}],e.typeoptions=[{label:"固定",value:"regular"},{label:"按类型",value:"bytype"}],e.data=[],e.currentIndex=0,e.modelIndex=0,e.headImgList=[],e.model={drawmode:"ladder"},e.imageList=[],e.isEdit=!1,e.fields=[{type:"radio-group",label:"费用设置",modelKey:"drawmode",props:{horizontal:!0,options:[{label:"附加费",value:"surcharge"},{label:"骑手费用",value:"delivery"},{label:"抽成设置",value:"percentage"}]},rules:{required:!0},messages:{required:"必须选择一种抽成方式"}}],e.savefields=[{type:"submit",label:"保存"}],e.options={scrollToInvalidField:!0,layout:"classic"},e}return Object(c["a"])(t,e),Object(l["a"])(t,[{key:"addSurcharge",value:function(){this.surchargeConfig.push({label:"",trigger:"bycost",rule:[{section:[0,0],fee:0}],sultType:[]})}},{key:"addRule",value:function(e){if(this.surchargeConfig[e].rule&&this.surchargeConfig[e].rule.length>0){var t=this.surchargeConfig[e].rule[this.surchargeConfig[e].rule.length-1].section[1];this.surchargeConfig[e].rule.push({section:[t,0],fee:0})}else this.surchargeConfig[e].rule.push({section:[0,0],fee:0})}},{key:"surchargeValidate",value:function(){var e=this,t=!0;return this.surchargeConfig.some(function(a){if(!a.label){var n=e.$createToast({txt:"请输入附加费名称",type:"error"});return n.show(),t=!1,!0}var r=a.rule;if(0===r.length){var i=e.$createToast({txt:"请添加费用规则",type:"error"});return i.show(),t=!1,!0}var l=!1,s=null;if(r.some(function(a,n){if(r.length-1!==n&&a.section[1]<=a.section[0]){var i=e.$createToast({txt:"梯费用结束值值需大于开始值",type:"error"});return i.show(),t=!1,!0}if(s){if(s.section[1]!==a.section[0]){l=!0;var o=e.$createToast({txt:"后阶梯费用开始值需等于前阶梯费用结束值",type:"error"});return o.show(),t=!1,!0}}else s=a}),l)return!0}),t}},{key:"rewardValidate",value:function(){var e=!0,t=this.rewardConfig.type;if("ladder"===t){var a=this.rewardLadderValidate();if(!a)return void(e=!1)}else if("fixed"===t&&(this.rewardvalue.fixed.value=Number(this.rewardvalue.fixed.value),0>this.rewardvalue.fixed.value||isNaN(this.rewardvalue.fixed.value))){var n=this.$createToast({txt:"固定值需大于等于0",type:"error"});return n.show(),void(e=!1)}return e}},{key:"rewardLadderValidate",value:function(){var e=this;this.rewardvalue.ladder=this.rewardvalue.ladder.map(function(e){return{section:[isNaN(Number(e.section[0]))?0:Number(e.section[0]),isNaN(Number(e.section[1]))?0:Number(e.section[1])],fee:isNaN(Number(e.fee))?0:Number(e.fee)}});var t=!0;if(this.rewardvalue.ladder.length<=0){t=!1;var a=this.$createToast({txt:"请设置阶梯",type:"error"});a.show()}else{var n;this.rewardvalue.ladder.some(function(a){if(n){if(a.section[0]!==n[1]){t=!1;var r=e.$createToast({txt:"后一阶梯最小值需等于前一个阶梯最大值",type:"error"});return r.show(),!0}n=a.section}else if(n=a.section,0!==n[0]){t=!1;var i=e.$createToast({txt:"阶梯收费需要从0开始",type:"error"});return i.show(),!0}if(n[1]<=n[0]){t=!1;var l=e.$createToast({txt:"阶梯收费结束费用需大于起始费用",type:"error"});return l.show(),!0}})}return t}},{key:"deleteConfig",value:function(e){this.surchargeConfig.splice(e,1)}},{key:"deleteSection",value:function(e,t){this.surchargeConfig[e].rule.splice(t,1)}},{key:"addRewardLadder",value:function(){this.rewardvalue.ladder.push({section:[0,0],fee:0})}},{key:"deleteRewardLadder",value:function(e){this.rewardvalue.ladder.splice(e,1)}},{key:"addPercentageLadder",value:function(){this.percentageValue.ladder.push({section:[0,0],fee:0,type:"regular"})}},{key:"deletePercentageLadder",value:function(e){this.percentageValue.ladder.splice(e,1)}},{key:"typeOptionsChange",value:function(e,t){"ladder"===this.percentageConfig.type?"bytype"===this.percentageValue[this.percentageConfig.type][e].type&&(this.percentageValue[this.percentageConfig.type][e].typefee||(this.percentageValue[this.percentageConfig.type][e].typefee={delivery:0,selflifting:0})):"bytype"===this.percentageValue[this.percentageConfig.type].type&&(this.percentageValue[this.percentageConfig.type].typeValue||(this.percentageValue[this.percentageConfig.type].typeValue={delivery:0,selflifting:0}))}},{key:"created",value:function(){var e=Object(g["a"])(this.$route.params);this.pageTitle=e.title,this.initConfig(e),this.headImgList=[e.headImg]}},{key:"resetHandler",value:function(){this.$emit("cancel")}},{key:"submitHandler",value:function(e){var t=this;e.preventDefault();var a=this,n={extracharge:a.surchargeConfig,tApConfig:{type:a.rewardConfig.type,value:a.rewardvalue[a.rewardConfig.type]},dfConfig:{type:a.percentageConfig.type,value:a.percentageValue[a.percentageConfig.type]}};if(console.log(n,"oooooooooooooooooooooooooo"),this.surchargeValidate()&&this.rewardValidate()){var r={severalConfig:n};this.$store.dispatch("updateShopInfoByObj",{shopId:this.shopId,value:{severalConfig:n}}).then(function(e){e.success&&t.$createDialog({type:"alert",content:"保存成功",onConfirm:function(e){t.$router.push({name:"businessManagement",params:{id:t.shopId,oprate:"update",data:r}})}}).show()})}}},{key:"showToastType",value:function(){var e=this.$createToast({txt:"保存成功",type:"correct"});e.show()}},{key:"initConfig",value:function(e){console.log(e,"shopdata");var t=e.severalConfig;e&&t&&(this.surchargeConfig=t.extracharge,this.rewardConfig={type:t.tApConfig.type},this.rewardvalue[t.tApConfig.type]=t.tApConfig.value,this.percentageConfig={type:t.dfConfig.type},this.percentageValue[t.dfConfig.type]=t.dfConfig.value),this.model={drawmode:"surcharge"}}},{key:"shopId",get:function(){return this.$route.params.id}},{key:"shopName",get:function(){return this.$route.query.shopName}},{key:"schoolInfo",get:function(){return this.$store.state.schoolInfo}}]),t}(p["c"]);b=Object(u["a"])([Object(p["a"])({components:{page:d["a"],rightBox:f["a"],editBox:v["a"]}})],b);var y=b,h=y,m=(a("d7d5"),a("2877")),x=Object(m["a"])(h,n,r,!1,null,"c6d5dfca",null);t["default"]=x.exports},b493:function(e,t,a){"use strict";var n=a("a387"),r=a.n(n);r.a},c88e:function(e,t,a){"use strict";a.d(t,"a",function(){return r});var n=a("7618");a("3b2b"),a("a481");var r=function e(t){var a;if("object"===Object(n["a"])(t))if(null===t)a=null;else if(t instanceof Date)a=t;else if(t instanceof Array){a=[];for(var r=0,i=t.length;r<i;r++)a.push(e(t[r]))}else for(var l in a={},t)a[l]=e(t[l]);else a=t;return a}},d7d5:function(e,t,a){"use strict";var n=a("f189"),r=a.n(n);r.a},e835:function(e,t,a){},f189:function(e,t,a){},fa15:function(e,t,a){"use strict";var n=a("e835"),r=a.n(n);r.a}}]);
//# sourceMappingURL=severalFeeConfig.9c500819.js.map