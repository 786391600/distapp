(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["atOrder"],{1525:function(t,e,i){},"47d5":function(t,e,i){"use strict";var o=i("5d86"),n=i.n(o);n.a},"5d86":function(t,e,i){},8786:function(t,e,i){"use strict";var o=i("1525"),n=i.n(o);n.a},a027:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"atOrder"},[i("selectCommodity",{attrs:{isAtOrder:!0}})],1)},n=[],a=(i("ac6a"),i("a481"),i("28a5"),i("d225")),s=i("b0b4"),r=i("308d"),c=i("6bb5"),u=i("4e2b"),d=i("9ab4"),l=i("60a3"),p=i("18a0"),h=i.n(p),f=i("da92"),m=i("d70a"),y=function(t){function e(){var t;return Object(a["a"])(this,e),t=Object(r["a"])(this,Object(c["a"])(e).apply(this,arguments)),t.indicator=!1,t.model={phone:"",openid:""},t.actions=[{text:"合计 ¥00.00",action:"moreMoney"},{type:"button",text:'<div class="payButton">立即购买</div>',action:"payButtonClickHandle"}],t.page=1,t.commodityId="",t.commodityObj={},t.commodityNum=1,t.totalCost=0,t.userInfo={},t.openid="",t.payButtonClick=!1,t.weixinInfo={},t.payShowVisible=!1,t}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"activated",value:function(){this.$store.commit("SET_SESSION_ID","noSession"),this.$store.state.isUserInfoBack?(this.$set(this,"userInfo",this.$store.state.commodityUserInfo),this.payButtonClick&&this.payButtonClickHandle()):this.pageInit()}},{key:"selectCommodityListChanged",value:function(t){this.actions[0].text="合计 ¥"+t}},{key:"validateHandler",value:function(t){this.validity=t.validity,this.valid=t.valid}},{key:"getUserInfo",value:function(){var t=this,e=this.$route.query;if(e.code){var i=this["$createToast"]({time:0,txt:"数据获取中..."});i.show(),this.$store.dispatch("getCommodityUserInfo",{code:e.code}).then(function(e){e.success&&e.data.openid&&(t.openid=e.data.openid,t.getWeiXinConfig(),e.data.userInfo&&(t.userInfo=e.data.userInfo),e.data.weixinInfo&&(t.weixinInfo=e.data.weixinInfo)),i.hide()})}else console.log("不是微信登陆")}},{key:"pageInit",value:function(){var t=this.$route.query,e=t.state;if(e){var i=e.split("@");"commodity"===i[0]&&(this.commodityId=i[1].replace(/\'/g,""))}t.code&&this.getUserInfo()}},{key:"getCommodityById",value:function(){var t=this,e=this["$createToast"]({time:0,txt:"数据获取中..."});e.show(),this.$store.dispatch("getCommodityById",{id:this.commodityId}).then(function(i){i.success&&(t.$set(t,"commodityObj",i.data),t.initTotalCost()),e.hide()})}},{key:"fenToYuan",value:function(t){return"number"!==typeof t||isNaN(t)?null:"合计 ¥"+f["a"].strip((t/100).toFixed(2))}},{key:"getWeiXinConfig",value:function(){var t=window.location.href;this.$store.dispatch("getWeixinConfig",{url:t}).then(function(t){if(console.log("获取微信配置成功",t),t.success){var e=t.data;h.a.config({debug:!1,appId:e.appId,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["chooseWXPay"]})}h.a.ready(function(){console.log("ready========")}),h.a.error(function(t){console.log(t),console.log("errrrrrrrrrrrrrr")})})}},{key:"clickHandler",value:function(t){t.action&&this[t.action](t)}},{key:"payButtonClickHandle",value:function(){this.payButtonClick=!0;var t=[];if(this.$store.state.selectCommodityList.forEach(function(e){var i={};i.id=e.id,i.name=e.name,i.num=e.num,i.price=e.price,t.push(i)}),t.length<=0){var e=this.$createToast({txt:"请选择商品",type:"error"});e.show()}else if(this.userInfo.phone&&this.userInfo.address){var i=this,o={};o.fee=this.selectCommodityPrice,o.body="集合订单",o.openid=this.openid,o.commodityList=t,this.$store.dispatch("setCommodityOrder",o).then(function(t){if(t.success){var e=t.data;h.a.chooseWXPay({timestamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success:function(t){i.payButtonClick=!1;var e=i.$createToast({time:2e3,txt:"订单处理中...",mask:!0,onTimeout:function(){i.$router.replace({path:"/paySuccess",query:{openid:i.openid}})}});e.show()},error:function(){}})}})}else this.$router.push({path:"/orderConfirm",query:{userInfo:this.userInfo,openid:this.openid}})}},{key:"shoppingClick",value:function(){this.payShowVisible=!this.payShowVisible}},{key:"payShowCancel",value:function(){this.payShowVisible=!1}},{key:"selectCommodityPrice",get:function(){var t=0;return this.$store.state.selectCommodityList.forEach(function(e){t+=e.price*e.num}),f["a"].strip(t)}},{key:"computedMsg",get:function(){return"computed "+this.propB}}]),e}(l["c"]);Object(d["a"])([Object(l["d"])("selectCommodityPrice")],y.prototype,"selectCommodityListChanged",null),Object(d["a"])([Object(l["b"])({default:"default value"})],y.prototype,"propB",void 0),y=Object(d["a"])([Object(l["a"])({components:{selectCommodity:m["a"]},filters:{getFormatDate:function(t){return new Date(t).getFullYear()+"年"+(new Date(t).getMonth()+1)+"月"+new Date(t).getDate()},fenToYuan:function(t){return"number"!==typeof t||isNaN(t)?null:"¥"+(t/100).toFixed(2)}}})],y);var v=y,g=v,b=(i("8786"),i("47d5"),i("2877")),C=Object(b["a"])(g,o,n,!1,null,"1329b742",null);e["default"]=C.exports}}]);
//# sourceMappingURL=atOrder.b4559bbe.js.map