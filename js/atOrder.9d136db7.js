(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["atOrder"],{"035a":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"box"},[i("div",{staticClass:"app-box"},[i("keep-alive",[i(t.selectedLabelDefault,{tag:"component"})],1)],1),i("div",{staticClass:"app-tab"},[i("cube-tab-bar",{on:{click:t.clickHandler,change:t.changeHandler},model:{value:t.selectedLabelDefault,callback:function(e){t.selectedLabelDefault=e},expression:"selectedLabelDefault"}},t._l(t.tabs,function(e,s){return i("cube-tab",{key:s,attrs:{label:e.value}},[i("div",[i("i",{class:["iconfont",e.icon],attrs:{slot:"icon"},slot:"icon"})]),i("div",{staticClass:"label"},[t._v(t._s(e.label))])])}),1)],1)])},n=[],a=i("d225"),o=i("b0b4"),c=i("308d"),r=i("6bb5"),u=i("4e2b"),l=i("9ab4"),d=i("60a3"),p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"box"},[t._v("\n  "+t._s(t.sessionId)+"\n  "),i("div",{staticClass:"app-con"},[i("div",{staticClass:"app-con-tit"},[t._v("营销拓客")]),i("div",{staticClass:"app-con-box"},t._l(t.appList,function(e,s){return i("div",{key:s,staticClass:"app-block",on:{click:function(i){return t.appClick(e)}}},[i("div",{staticClass:"icon"},[i("i",{class:["iconfont",e.icon]})]),i("div",{staticClass:"label"},[t._v(t._s(e.label))])])}),0)])])},m=[],h=i("319c"),f=function(t){function e(){var t;return Object(a["a"])(this,e),t=Object(c["a"])(this,Object(r["a"])(e).apply(this,arguments)),t.sessionId="",t.appList=[{icon:"iconshangpin",label:"商品管理",path:"/commodityClass"},{icon:"iconshangpin",label:"在线传单"},{icon:"iconshangpin",label:"群发短信"},{icon:"iconshangpin",label:"客户"},{icon:"iconshangpin",label:"群活码"}],t}return Object(u["a"])(e,t),Object(o["a"])(e,[{key:"mounted",value:function(){console.log(this.$route,"ppppppppppppppppppppppp"),this.sessionId=this.$route.query.sessionId}},{key:"appClick",value:function(t){t.path&&this.$router.push({path:t.path,query:{state:"business@5693c8b0-f97f-11ea-8165-3111824eebe8"}})}}]),e}(d["c"]);f=Object(l["a"])([Object(d["a"])({components:{banner:h["a"]}})],f);var y=f,b=y,v=(i("775d"),i("2877")),g=Object(v["a"])(b,p,m,!1,null,"494eb0b0",null),C=g.exports,O=function(t){function e(){var t;return Object(a["a"])(this,e),t=Object(c["a"])(this,Object(r["a"])(e).apply(this,arguments)),t.selectedLabelDefault="appList",t.tabs=[{label:"工作中心",icon:"icon_yingyong",value:"appList"},{label:"我的",icon:"icon_gongzhonghao",value:"myconfig"}],t}return Object(u["a"])(e,t),Object(o["a"])(e,[{key:"clickHandler",value:function(t){console.log(t)}},{key:"changeHandler",value:function(t){}}]),e}(d["c"]);O=Object(l["a"])([Object(d["a"])({components:{appList:C}})],O);var k=O,j=k,I=(i("afac"),Object(v["a"])(j,s,n,!1,null,"f944ae40",null));e["default"]=I.exports},"0c52":function(t,e,i){"use strict";var s=i("2d9d"),n=i.n(s);n.a},2158:function(t,e,i){},"2d9d":function(t,e,i){},"47d5":function(t,e,i){"use strict";var s=i("5d86"),n=i.n(s);n.a},"5c5d":function(t,e,i){},"5d86":function(t,e,i){},"775d":function(t,e,i){"use strict";var s=i("a697"),n=i.n(s);n.a},"7e52":function(t,e,i){},a027:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"atOrder"},[i("previewOrder"),i("payClick",{attrs:{actions:t.actions},on:{click:t.clickHandler}})],1)},n=[],a=(i("ac6a"),i("96cf"),i("3b8d")),o=(i("a481"),i("28a5"),i("d225")),c=i("b0b4"),r=i("308d"),u=i("6bb5"),l=i("4e2b"),d=i("9ab4"),p=i("60a3"),m=i("18a0"),h=i.n(m),f=i("da92"),y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{isAtOrder:!0}},[i("div",{ref:"selectlist",staticClass:"atOrderBox"},[i("p",{staticClass:"atOrderBox-title"},[t._v("订单确认")]),i("div",{style:t.autoHeight},[i("cube-scroll",{ref:"atScroll",attrs:{data:t.selectCommodityList,options:t.options}},[i("ul",{staticClass:"foods-wrapper"},t._l(t.selectCommodityList,function(e,s){return i("li",{staticClass:"atOrderBox-li"},[i("div",{staticClass:"image"},[i("img",{attrs:{src:e.imgUrlList&&e.imgUrlList.length>0?e.imgUrlList[0]+"?w=100":""}})]),i("div",{staticClass:"atOrderBox-info"},[i("div",{staticClass:"atOrderBox-info-name"},[i("span",{staticClass:"name"},[t._v(t._s(e.name))]),i("span",{staticClass:"price"},[t._v(t._s(t.getFoodPrice(e)))])]),i("div",{staticClass:"atOrderBox-info-num"},[i("span",[t._v("数量:"+t._s(e.num)+t._s(e.unit))])])])])}),0)])],1),i("div",{staticClass:"atOrderBox-bottom"},[i("span",{staticStyle:{"margin-left":"3px"}},[t._v("小计")]),t._v(t._s(t.selectCommodityPrice))])])])},b=[],v=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(r["a"])(this,Object(u["a"])(e).apply(this,arguments)),t.autoHeight={height:"auto"},t}return Object(l["a"])(e,t),Object(c["a"])(e,[{key:"activated",value:function(){this.isShowChange(!0)}},{key:"getFoodPrice",value:function(t){return"¥"+f["a"].strip(t.num*t.price)}},{key:"foodAdd",value:function(t,e){var i=t.num||0;this.$set(this.selectCommodityList[e],"num",i+1),this.$store.commit("SET_SELECT_COMMODITY_LIST",{type:"add",item:this.selectCommodityList[e]});var s=t.class;this.setClassNum(s,"add")}},{key:"setClassNum",value:function(t,e){this.$store.commit("SET_SELECT_COMMODITY_NUM",{classId:t,type:e})}},{key:"foodReduce",value:function(t,e){t.num;var i=t.num-1;this.$set(this.selectCommodityList[e],"num",i),this.$store.commit("SET_SELECT_COMMODITY_LIST",{type:"reduce",item:this.selectCommodityList[e]});var s=t.class;this.setClassNum(s,"reduce")}},{key:"isShowChange",value:function(t){console.log("999999999999999"),this.selectCommodityList.length>3?this.autoHeight.height="274px":this.autoHeight.height="auto",this.$nextTick(function(){this.$refs.atScroll.refresh()})}},{key:"emptyCommodity",value:function(){this.$store.commit("EMPTY_COMMODITY")}},{key:"options",get:function(){return{pullDownRefresh:!1,pullUpLoad:!1,scrollbar:{fade:!1}}}},{key:"selectCommodityList",get:function(){return this.$store.state.selectCommodityList}},{key:"commodityNum",get:function(){var t=0;return this.$store.state.selectCommodityList.forEach(function(e){return t+=e.num}),t}},{key:"selectCommodityPrice",get:function(){var t=0;return this.$store.state.selectCommodityList.forEach(function(e){t+=e.price*e.num}),"¥"+f["a"].strip(t)}}]),e}(p["c"]);Object(d["a"])([Object(p["b"])({default:!1})],v.prototype,"isShow",void 0),Object(d["a"])([Object(p["d"])("selectCommodityList")],v.prototype,"isShowChange",null),v=Object(d["a"])([Object(p["a"])({components:{},filters:{getFoodNum:function(t){return t.num&&t.num>0?t.num:0}}})],v);var g=v,C=g,O=(i("0c52"),i("2877")),k=Object(O["a"])(C,y,b,!1,null,"32715893",null),j=k.exports,I=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"toolbar"},[i("span",{staticClass:"price"},[t._v(t._s(t.actions[0].text))]),i("div",{staticClass:"btn",on:{click:t.paymentClick}},[t._v("下单并支付")])])},_=[],$=function(t){function e(){return Object(o["a"])(this,e),Object(r["a"])(this,Object(u["a"])(e).apply(this,arguments))}return Object(l["a"])(e,t),Object(c["a"])(e,[{key:"mounted",value:function(){}},{key:"paymentClick",value:function(){this.$emit("click",{action:"payButtonClickHandle"})}},{key:"shoppingClick",value:function(){this.commodityNum>0&&this.$emit("click",{action:"shoppingClick"})}},{key:"commodityNum",get:function(){var t=0;return this.$store.state.selectCommodityList.forEach(function(e){return t+=e.num}),t}}]),e}(p["c"]);Object(d["a"])([Object(p["b"])({default:""})],$.prototype,"actions",void 0),$=Object(d["a"])([Object(p["a"])({components:{},filters:{}})],$);var x=$,L=x,w=(i("a4ed"),Object(O["a"])(L,I,_,!1,null,"421c7ac2",null)),S=w.exports,T=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(r["a"])(this,Object(u["a"])(e).apply(this,arguments)),t.indicator=!1,t.model={phone:"",openid:""},t.actions=[{text:"¥00.00",action:"moreMoney"},{type:"button",text:'<div class="payButton">立即购买</div>',action:"payButtonClickHandle"}],t.page=1,t.commodityId="",t.commodityObj={},t.commodityNum=1,t.totalCost=0,t.userInfo={phone:"",address:""},t.openid="",t.payButtonClick=!1,t.weixinInfo={},t.payShowVisible=!1,t}return Object(l["a"])(e,t),Object(c["a"])(e,[{key:"activated",value:function(){this.$store.commit("SET_SESSION_ID","noSession");var t=this.$route.query.userInfo;this.openid=this.$route.query.openid,this.$set(this,"userInfo",t),this.actions[0].text="¥"+this.selectCommodityPrice}},{key:"selectCommodityListChanged",value:function(t){this.actions[0].text="¥"+t}},{key:"getUserInfo",value:function(){var t=this,e=this.$route.query;if(e.code){var i=this["$createToast"]({time:0,txt:"数据获取中..."});i.show(),this.$store.dispatch("getCommodityUserInfo",{code:e.code}).then(function(e){e.success&&e.data.openid&&(t.openid=e.data.openid,t.getWeiXinConfig(),e.data.userInfo&&(t.userInfo=e.data.userInfo),e.data.weixinInfo&&(t.weixinInfo=e.data.weixinInfo)),i.hide()})}else console.log("不是微信登陆")}},{key:"pageInit",value:function(){var t=this.$route.query,e=t.state;if(e){var i=e.split("@");"commodity"===i[0]&&(this.commodityId=i[1].replace(/\'/g,""))}t.code&&this.getUserInfo()}},{key:"getCommodityById",value:function(){var t=this,e=this["$createToast"]({time:0,txt:"数据获取中..."});e.show(),this.$store.dispatch("getCommodityById",{id:this.commodityId}).then(function(i){i.success&&t.$set(t,"commodityObj",i.data),e.hide()})}},{key:"fenToYuan",value:function(t){return"number"!==typeof t||isNaN(t)?null:"合计 ¥"+f["a"].strip((t/100).toFixed(2))}},{key:"getWeiXinConfig",value:function(){var t=window.location.href;this.$store.dispatch("getWeixinConfig",{url:t}).then(function(t){if(console.log("获取微信配置成功",t),t.success){var e=t.data;h.a.config({debug:!1,appId:e.appId,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["chooseWXPay"]})}h.a.ready(function(){}),h.a.error(function(t){})})}},{key:"clickHandler",value:function(t){t.action&&this[t.action](t)}},{key:"payButtonClickHandle",value:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){var e,i,s,n,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.payButtonClick=!0,e=[],console.log(this.$store.state.selectCommodityList),this.$store.state.selectCommodityList.forEach(function(t){var i={};i.id=t.id,i.name=t.name,i.num=t.num,i.price=t.price,i.imgUrl=t.imgUrlList[0],e.push(i)}),console.log(this.$store.state.businessId,"this.$store.state.businessId"),!(e.length<=0)){t.next=9;break}return i=this.$createToast({txt:"请选择商品",type:"error"}),i.show(),t.abrupt("return");case 9:return console.log("type=commodity&commodityList="+JSON.stringify(e)+"&fee="+this.selectCommodityPrice+"&businessId="+this.$store.state.businessId),t.next=12,this.getIsMiniProgram();case 12:if(s=t.sent,!s){t.next=16;break}return h.a.miniProgram.navigateTo({url:"/pages/jumbprocess/index?type=commodity&commodityList="+JSON.stringify(e)+"&fee="+this.selectCommodityPrice+"&businessId="+this.$store.state.businessId}),t.abrupt("return");case 16:this.userInfo.phone&&this.userInfo.address?(n=this,a={},a.fee=this.selectCommodityPrice,a.body="集合订单",a.openid=this.openid,a.commodityList=e,a.businessId=this.$store.state.businessId,this.$store.dispatch("setCommodityOrder",a).then(function(t){if(t.success){var e=t.data;h.a.chooseWXPay({timestamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success:function(t){n.payButtonClick=!1;var e=n.$createToast({time:2e3,txt:"订单处理中...",mask:!0,onTimeout:function(){n.$router.replace({path:"/paySuccess",query:{openid:n.openid}})}});e.show()},error:function(){}})}})):this.$router.push({path:"/orderConfirm",query:{userInfo:this.userInfo,openid:this.openid}});case 17:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"shoppingClick",value:function(){this.payShowVisible=!this.payShowVisible}},{key:"payShowCancel",value:function(){this.payShowVisible=!1}},{key:"getIsMiniProgram",value:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t){h.a.miniProgram.getEnv(function(e){t(e.miniprogram)})}));case 1:case"end":return t.stop()}},t)}));function e(){return t.apply(this,arguments)}return e}()},{key:"selectCommodityPrice",get:function(){var t=0;return this.$store.state.selectCommodityList.forEach(function(e){t+=e.price*e.num}),f["a"].strip(t)}},{key:"computedMsg",get:function(){return"computed "+this.propB}}]),e}(p["c"]);Object(d["a"])([Object(p["d"])("selectCommodityPrice")],T.prototype,"selectCommodityListChanged",null),Object(d["a"])([Object(p["b"])({default:"default value"})],T.prototype,"propB",void 0),T=Object(d["a"])([Object(p["a"])({components:{previewOrder:j,payClick:S},filters:{getFormatDate:function(t){return new Date(t).getFullYear()+"年"+(new Date(t).getMonth()+1)+"月"+new Date(t).getDate()},fenToYuan:function(t){return"number"!==typeof t||isNaN(t)?null:"¥"+(t/100).toFixed(2)}}})],T);var E=T,B=E,P=(i("bdbd"),i("47d5"),Object(O["a"])(B,s,n,!1,null,"d3886320",null));e["default"]=P.exports},a4ed:function(t,e,i){"use strict";var s=i("7e52"),n=i.n(s);n.a},a697:function(t,e,i){},afac:function(t,e,i){"use strict";var s=i("5c5d"),n=i.n(s);n.a},bdbd:function(t,e,i){"use strict";var s=i("2158"),n=i.n(s);n.a}}]);
//# sourceMappingURL=atOrder.9d136db7.js.map